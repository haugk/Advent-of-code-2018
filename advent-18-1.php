<?php

$tt = <<<EOT
..|.#.....|.....##...#|..||...#.|#.#.||...#.....#|
#...|.....|.|.#....#.|.|...|.#.||..#....#||.#||#..
.......|.....|....|...||.|##|.#|.....|#..##.|...||
.......#.##|...|.|.#....||.#....|#.....#..|..|....
|...#...##.|#...|...#..|#|#.|...#...||#.|..||.....
...#...#..|..#.||...|..#..#...#.|#||#|...#|..#..|.
....|..|...#||.|.|#|...|#....|.#...##..|..|#.|##..
##.##..|#|...##......###.......||.|...|..|........
..#|....###......|..##.|..|...##..|.|...###.#..#..
#|#.|#.|#.#.......#....#...#.|...#||.#||||......|.
|#|.........#|..|.||........#...|.|#..#.#..##.##..
.|...#|..||.|...|...|#|.||#..#.||..#|#.|..#.....#.
||.....#...||......#|..##....||#.|.|...#..||.#.||.
......#.##||.#.|..#.....|.......|.#.....||..|#.#|.
.....##|#....#.#.#.#|..#.#.....#..|.#.|##||.#...##
##.#.#|.###.#.#...|.|......|#...#......|.|........
##....|##.|...#..#......#.|....|........#.......#.
#..#..#.#......#|#.|#....||.#|..#..|.#.|.#.||....|
|.#.....|....#..#.#..#.....||.#..|....#|.#...##...
.###....#...|.|.|.#.###.|..#|....|..|......|......
....|..#...........##.##...|........#...#..#....||
.#.|#......#....#|||.#......#|#.|..|#|..#.|||..|..
#.|#.#||.|#.##||.#..#..|#...#.......|..#|#..##|.#.
#||##..|.................|...|#...#...|#.#..|..|.|
....|.#.|.#.|.|.##.|...|.#.|#.........#..|..#||.#.
....#.|.||..|..|.#.....#.##...#....||#|#..|.|##..|
..#.||#...#.#....|...........#.....#.#|..##.......
|........#..#|.#|....#.|..#..#.....###|#||..#...#.
...#.|...|##..||..|..#||..|.#.|.|..#.|.|.|#.|..|#|
##|.#|#|||..|........|#...|#.|.#..||#||.#|......#.
.....|#..##...|.......#.#.....#..|#..||...|###...|
..|###.#...|....#.|||.|#.|#|.#|....#.|.|..|#...#..
...|||##||...#.##|...||..|.#.#.||.||.|.#...|.|.|..
.#....#..|#...||........|.....|.|...#..#.|...|.|.|
.|...|#....|.|.#.||##|#|.#....#.#|#...|#|.#.|.|...
##|....||.|...|...#..#......#..#..#.|.#.#|##|...##
||...#||...#|..|.|#.#...#.#.|#.|........#....#..||
##...|#|..|....|......#..||...#|.|#|.......#....|.
##.#|.#...###.##...#.|......#.#|#|..||.#..#.#|.||.
###.....|##.........|.|..|||.......#..#....|..#.|.
..###||#..|#......|.|...|##..|.....#..#....#..|.#.
||....|.||..#..|.|||#|....#.#.|..|...#.|.......|.|
.....#.........##||.....#.|....#.##..#.##|.#|..||#
#..|#|||.||....|..#.#..|.|....#.|.||##.|.|.#.#....
##|....#.|.#|.|##..#.|#....|.|..#.....#|..#..|.#|#
.#|#.#..#..#....#......|.......#|.#.#|#..#....#...
......|..|##.#..|.....|#...#.#.|..|.#.|##.........
#...#....||.|#.....|..#|.......|.|..#..#.|...|#...
..#|.|##.#.#.|.#...#||.##...|......##.#.|..#||#.#.
..|.###.#.#|.|..#.#..#||.|..#|#..#...#.|.#|....|..
EOT;

/*
$tt = <<<EOT
.#.#...|#.
.....#|##|
.|..|...#.
..|#.....#
#.#|||#|#|
...#.||...
.|....|...
||...#|.#|
|.||||..|.
...#.|..|.
EOT;
*/

/*
An [.] will become [|] if three or more adjacent acres contained [|]. Otherwise, nothing happens.
An [|] will become a [#] if three or more adjacent acres were [#]. Otherwise, nothing happens.
An [#] will remain a [#] if it was adjacent to at least one [#] and at least one [|]. Otherwise, it becomes [.].
*/

$t = str_replace(' ','',$tt);

$t = explode("\n", $t);
//print_r($t);


function op($code, $a, $b, $c, $reg)
{
	switch ($code) {
		case 0:
			// addr (add register) stores into register C the result of adding register A and register B.
			echo "\n\nADDR $a $b $c";
			$reg[$c] = $reg[$a] + $reg[$b];
			break;
	}	

	return $reg;
}

function plot($grid)
{
	for ($i=0;$i<count($grid);$i++)
	{
		$l = implode($grid[$i]);
		echo "\n$l";
	}
}

$reg = [0,0,0,0];
foreach ($t as $i => $l)
{
	$l = str_split($l);
	array_push($l, ' ');
	array_unshift($l, ' ');
	$t[$i] = $l;
}

$e = array_fill(0, count($t[0]), ' ');
array_push($t, $e);
array_unshift($t, $e);
//print_r($t);

//plot($t);



/*
echo "\n  ", ord(' ');
echo "\n. ", ord('.');
echo "\n| ", ord('|');
echo "\n# ", ord('#');
*/

const SPACE = 32;
const OPEN = 46;
const WOOD = 124;
const LUMBER = 35;

$n = 1E3;
$s = $t;
echo "\n$n";
echo "\nThe time is " . date("h:i:sa");
$total= 0;
for ($i=0;$i<$n;$i++)
{
	// generation
	for ($k=1;$k<count($t)-1;$k++)
	{
		for ($l=1;$l<count($t[$k])-1;$l++)
		{
			// count acres around target acre
			$acres = [OPEN =>0, WOOD => 0, LUMBER => 0, SPACE => 0];
			
			$acres[ord($t[$k-1][$l-1])]++;
			$acres[ord($t[$k][$l-1])]++;
			$acres[ord($t[$k+1][$l-1])]++;
			
			$acres[ord($t[$k-1][$l])]++;
			$acres[ord($t[$k+1][$l])]++;
			
			$acres[ord($t[$k-1][$l+1])]++;
			$acres[ord($t[$k][$l+1])]++;
			$acres[ord($t[$k+1][$l+1])]++;
			
			$a = $t[$k][$l];
			$s[$k][$l] = $t[$k][$l];
			
			switch ($a) {
				case '.':
					if ($acres[WOOD] > 2) 
						$s[$k][$l] = '|';
					break;
				case '|':
					if ($acres[LUMBER] > 2) 
						$s[$k][$l] = '#';
					break;
				case '#':
					if ($acres[WOOD] < 1 || $acres[LUMBER] < 1) 
						$s[$k][$l] = '.';
					break;
			}	

			
//			print_r($acres);
			
		}
	}
	$acres = [OPEN =>0, WOOD => 0, LUMBER => 0, SPACE => 0];
	for ($k=1;$k<count($t)-1;$k++)
	{
		for ($l=1;$l<count($t[$k])-1;$l++)
		{
			$t[$k][$l] = $s[$k][$l];
			$acres[ord($t[$k][$l])]++;
		}
	}
	
	$total = $acres[WOOD]*$acres[LUMBER];
	echo "\n", ($i % 28 ), ' ', $total;	
	
	if ($i % 28 == 20)
	{
//    		echo "\n$i";
//	print_r($acres);
//		plot($t);
//		sleep(1);
//		$total = $acres[WOOD]*$acres[LUMBER];
	}
//	echo "\n",$acres[WOOD]*$acres[LUMBER];

}

echo "\nThe time is " . date("h:i:sa");

//	plot($t);
//	echo "\nTotal resources: ",$total;



echo "\n1E9 mod 28 = ", 1E9 % 28;



echo "\n\n· • · • · • · S L U T · • · • · • ·";

?>